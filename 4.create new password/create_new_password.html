<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Create New Password</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" href="styles.css" />
  </head>
  <body>
    <div
      class="container d-flex justify-content-center align-items-center vh-100"
    >
      <div class="card shadow-lg p-4 rounded custom-card">
        <h3 class="text-center mb-3">Create New Password</h3>
        <p class="text-center text-muted mb-4">
          Please enter and confirm your new password here.
        </p>
        <form id="">
          <!-- Password Input -->
          <div class="mb-3 position-relative">
            <input
              type="password"
              class="form-control"
              id="newPassword"
              placeholder="Create new password"
              required
            />
            <span
              class="position-absolute end-0 top-50 translate-middle-y me-3"
            >
              <i class="bi bi-eye-slash" id="toggleNewPassword"></i>
            </span>
          </div>
          <!-- Confirm Password Input -->
          <div class="mb-3 position-relative">
            <input
              type="password"
              class="form-control"
              id="confirmPassword"
              placeholder="Confirm your password"
              required
            />
            <span
              class="position-absolute end-0 top-50 translate-middle-y me-3"
            >
              <i class="bi bi-eye-slash" id="toggleConfirmPassword"></i>
            </span>
          </div>
          <!-- Submit Button -->
          <div class="d-grid mb-3">
            <button type="submit" class="btn btn-dark">Reset password</button>
          </div>
          <!-- Back to Login -->
          <div class="text-center mb-3">
            <a href="#" class="text-muted"
              >Back to <span class="fw-bold">Login</span></a
            >
          </div>
          <!-- Password Requirements -->
          <!-- <div class="text-muted small">
            <p class="mb-1">Your password must contain:</p>
            <ul class="ps-3">
              <li>At least 8 characters</li>
              <li>
                Include at least one number and special character [Special
                characters include: ~`!@#$%^&*()_-+=[]{}|;:"&lt;&gt;,.?/]
              </li>
            </ul>
          </div> -->
        </form>
      </div>
    </div>
    <!-- Bootstrap Bundle with JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <!-- Icons for Toggle -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap-icons/font/bootstrap-icons.css"></script>
    <!-- Custom JavaScript -->
    <script>
      // Toggle Password Visibility
      const toggleNewPassword = document.getElementById("toggleNewPassword");
      const toggleConfirmPassword = document.getElementById(
        "toggleConfirmPassword"
      );
      const newPassword = document.getElementById("newPassword");
      const confirmPassword = document.getElementById("confirmPassword");

      toggleNewPassword.addEventListener("click", () => {
        const type = newPassword.type === "password" ? "text" : "password";
        newPassword.type = type;
        toggleNewPassword.classList.toggle("bi-eye");
        toggleNewPassword.classList.toggle("bi-eye-slash");
      });

      toggleConfirmPassword.addEventListener("click", () => {
        const type = confirmPassword.type === "password" ? "text" : "password";
        confirmPassword.type = type;
        toggleConfirmPassword.classList.toggle("bi-eye");
        toggleConfirmPassword.classList.toggle("bi-eye-slash");
      });
    </script>
    <script>
      document.getElementById('reset-password-form').addEventListener('submit', function(event) {
          event.preventDefault();
          const token = document.getElementById('token').value;
          const newPassword = document.getElementById('new_password').value;
          const confirmPassword = document.getElementById('confirm_password').value;
          
          if (newPassword !== confirmPassword) {
             document.getElementById('reset-message').textContent = 'Passwords do not match';
              return;
          }
          
          fetch('/api/reset-password', {
              method: 'POST',
              headers: {
                  'Content-Type': 'application/json'
              },
              body: JSON.stringify({ token: token, newPassword: newPassword })
          })
          .then(response => response.json())
          .then(data => {
              document.getElementById('reset-message').textContent = data.message;
             if (data.success){
              document.getElementById('reset-password-form').remove()
             }
          })
          .catch(error => {
              console.error('Error:', error);
          });
      });
    </script>
  </body>
</html>
