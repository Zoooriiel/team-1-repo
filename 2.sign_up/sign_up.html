<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Sign Up Form</title>
    <!-- Bootstrap 5 CSS -->
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css"
      rel="stylesheet"
    />
    <!-- Custom CSS -->
    <link rel="stylesheet" type="text/css" href="style.css" />
  </head>
  <body>
    <div class="form-container">
      <h2 class="text-center mb-4 fw-bold">Sign Up</h2>
      <!-- Sign Up Form -->
      <form id="signup-form">
        <div class="mb-3">
          <input
            type="text"
            id="fullname"
            class="form-control"
            placeholder="Full Name"
            required
          />
        </div>
        <div class="mb-3">
          <input
            type="text"
            id="username"
            class="form-control"
            placeholder="Username"
            required
          />
        </div>
        <div class="mb-3">
          <input
            type="email"
            id="email"
            class="form-control"
            placeholder="Email"
            required
          />
        </div>
        <div class="mb-3">
          <input
            type="password"
            id="password"
            class="form-control"
            placeholder="Password"
            required
          />
        </div>
        <div class="mb-3">
          <input
            type="password"
            id="password-confirmation"
            class="form-control"
            placeholder="Re-enter Password"
            required
          />
        </div>
        <!-- Sign Up Button -->
        <div class="d-grid">
          <button type="submit" class="btn btn-custom">Sign Up</button>
        </div>
      </form>
      <!-- Link to Forgot Password Page -->
      <div class="text-center mt-2">
        <small
          >Forgot password?
          <a href="../3.forgot_password/forgot_password.html"
            >Click here</a
          ></small
        >
      </div>
      <!-- Divider -->
      <div class="divider">
        <span>OR</span>
      </div>

      <!-- Social Sign Up Desktop-->
      <div class="social-buttons desktop-socials">
        <button class="btn btn-light btn-social w-100 border">
          <img
            src="https://img.icons8.com/color/20/google-logo.png"
            alt="Google"
          />
          Continue with Google
        </button>
        <button
          class="btn btn-primary d-flex align-items-center justify-content-center"
        >
          <img
            src="https://upload.wikimedia.org/wikipedia/commons/6/6c/Facebook_Logo_2023.png"
            alt="Facebook"
            width="20"
            class="me-2"
          />
          Continue with Facebook
        </button>
        <button
          class="btn btn-dark d-flex align-items-center justify-content-center"
        >
          <img
            src="https://img.icons8.com/?size=100&id=30840&format=png&color=FFFFFF"
            alt="Apple"
            width="20"
            class="me-2"
          />
          Continue with Apple
        </button>
      </div>
      <!-- Social Media Buttons Mobile -->
      <div
        class="hide-mobile mobile-socials d-flex justify-content-center gap-2"
      >
        <img
          src="https://img.icons8.com/?size=100&id=17949&format=png&color=000000"
          alt="Google"
          class="small-mobile-logos"
        />
        <img
          src="https://img.icons8.com/?size=100&id=118497&format=png&color=000000"
          alt="Facebook"
          class="small-mobile-logos"
        />
        <img
          src="https://img.icons8.com/?size=100&id=30840&format=png&color=000000"
          alt="Apple"
          class="small-mobile-logos"
        />
      </div>
    </div>

    <!-- Bootstrap 5 JS (optional for interactivity) -->
    <script src="https://cdn.jsdelivr.net/npm/@popperjs/core@2.11.6/dist/umd/popper.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.min.js"></script>

    <script>
      // DOMContentLoaded: Makes sure the script runs after the HTML is loaded.
      document.addEventListener("DOMContentLoaded", function () {
        // Gets references to form and input fields.
        const signupForm = document.getElementById("signup-form");
        const fullNameInput = document.getElementById("fullname");
        const usernameInput = document.getElementById("username");
        const emailInput = document.getElementById("email");
        const passwordInput = document.getElementById("password");
        const passwordConfirmationInput = document.getElementById(
          "password-confirmation"
        );

        //TODO
        //
        const formMessage = document.getElementById("form-message");

        // when user submits
        signupForm.addEventListener("submit", function (event) {
          //Prevents the default form submission.
          event.preventDefault();

          // TODO Reset error messages
          //
          resetErrorMessages();

          // Client-side validation (simple example) NEED TO REVISIT
          let isValid = true;

          //checks if fullname is empty. If yes, displays error message
          if (!fullnameInput.value.trim()) {
            displayErrorMessage("fullname", "Full Name is required.");
            isValid = false;
          }
          //checks if the username input field is empty. If it is, it displays an error message
          if (!usernameInput.value.trim()) {
            displayErrorMessage("username", "Username is required.");
            isValid = false;
          }
          // Checks for a basic email format using regex function isValidEmail
          if (!emailInput.value.trim()) {
            displayErrorMessage("email", "Email is required.");
            isValid = false;
          } else if (!isValidEmail(emailInput.value.trim())) {
            displayErrorMessage("email", "Invalid email format.");
            isValid = false;
          }
          // TODO Password: Checks length, uppercase, and digit presence.
          //
          if (!passwordInput.value.trim()) {
            displayErrorMessage("password", "Password is required.");
            isValid = false;
          }
          if (
            passwordConfirmationInput.value.trim() !==
            passwordInput.value.trim()
          ) {
            displayErrorMessage(
              "password-confirmation",
              "Passwords do not match."
            );
            isValid = false;
          }

          // if user entry is valid
          if (isValid) {
            const formData = {
              username: usernameInput.value,
              email: emailInput.value,
              password: passwordInput.value,
            };

            // Send to back-end
            fetch("/api/signup", {
              method: "POST",
              headers: {
                "Content-Type": "application/json",
              },
              body: JSON.stringify(formData),
            })
              .then((response) => response.json())
              .then((data) => {
                if (data.success) {
                  formMessage.textContent = "Signup successful!";
                  formMessage.style.backgroundColor = "lightgreen";
                  formMessage.style.display = "block";
                  setTimeout(() => {
                    window.location.href = "/login";
                  }, 1000);
                } else {
                  formMessage.textContent = "Signup failed: " + data.message;
                  formMessage.style.backgroundColor = "lightcoral";
                  formMessage.style.display = "block";
                }
              })
              .catch((error) => {
                console.error("Error:", error);
                formMessage.textContent =
                  "An error occurred. Please try again later.";
                formMessage.style.backgroundColor = "lightcoral";
                formMessage.style.display = "block";
              });
          }
        });

        // function to desplay error message
        function displayErrorMessage(fieldId, message) {
          const errorSpan = document.getElementById(fieldId + "-error");
          errorSpan.textContent = message;
          errorSpan.style.display = "block";
        }

        // function to reset error message
        function resetErrorMessages() {
          const errorSpans = document.querySelectorAll(".error-message");
          errorSpans.forEach((span) => {
            span.textContent = "";
            span.style.display = "none";
          });
        }

        // function Checks if the given email is valid by using a regex pattern.
        function isValidEmail(email) {
          const emailRegex = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
          return emailRegex.test(email);
        }
      });
    </script>
  </body>
</html>
